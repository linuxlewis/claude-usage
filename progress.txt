# Ralph Progress Log
Started: 2026-02-09T01:34:52.881Z

## Codebase Patterns
- Use Xcode project (not SPM) since MenuBarExtra requires app bundle with Info.plist
- Build command: `xcodebuild -scheme ClaudeUsage -destination 'platform=macOS' build`
- Test command: `xcodebuild test -scheme ClaudeUsage -destination 'platform=macOS'`
- Source files in ClaudeUsage/ directory, tests in ClaudeUsageTests/
- When adding new .swift files, they must be added to the pbxproj file with PBXFileReference, PBXBuildFile, and added to the Sources build phase
- Info.plist is at ClaudeUsage/Info.plist with LSUIElement=true for menu bar-only app
- API dates use ISO8601 with fractional seconds (e.g. "2026-02-08T18:59:59.661633+00:00") — use custom dateDecodingStrategy with ISO8601DateFormatter(.withFractionalSeconds) and fallback
- The usage API response has `resets_at` as a nullable Date string even within non-null limit objects (e.g. seven_day_sonnet can have utilization: 0.0 with resets_at: null)
- pbxproj IDs follow pattern: AA000005 for PBXBuildFile, AA100008 for PBXFileReference — increment from last used
- KeychainService uses service name "com.claudeusage.credentials" with account keys "sessionKey" and "orgId"

---

## 2026-02-08 20:06 - US-001
- What was implemented: Xcode project scaffold with SwiftUI MenuBarExtra app, Info.plist with LSUIElement=true, and XCTest target
- Files changed:
  - ClaudeUsage.xcodeproj/project.pbxproj (new - Xcode project definition)
  - ClaudeUsage.xcodeproj/xcshareddata/xcschemes/ClaudeUsage.xcscheme (new - shared scheme)
  - ClaudeUsage/ClaudeUsageApp.swift (new - SwiftUI @main app with MenuBarExtra)
  - ClaudeUsage/Views/ContentView.swift (new - placeholder popover content)
  - ClaudeUsage/Info.plist (new - app metadata with LSUIElement=true)
  - ClaudeUsageTests/ClaudeUsageTests.swift (new - basic test target)
  - CLAUDE.md (updated - corrected build commands and directory paths)
- **Learnings for future iterations:**
  - MenuBarExtra requires an app bundle, so SPM executable won't work — must use Xcode project
  - pbxproj uses unique IDs (AA000001 format used here) — new files need entries in PBXFileReference, PBXBuildFile, and the relevant PBXSourcesBuildPhase
  - The scheme file must reference the correct BlueprintIdentifier matching the PBXNativeTarget ID
  - macOS deployment target is set to 13.0 in both project and target build settings
  - Swift 6.2.1 is on this machine, but project uses SWIFT_VERSION = 5.0 for compatibility
---

## 2026-02-08 20:09 - US-002
- What was implemented: UsageData and UsageLimit Codable models for decoding the claude.ai usage API response. All optional fields (seven_day_opus, seven_day_cowork, seven_day_oauth_apps, iguana_necktie, extra_usage) are Swift Optionals. Added 4 unit tests covering full response decoding, null optional fields, all fields present, and utilization value accuracy.
- Files changed:
  - ClaudeUsage/Models/UsageData.swift (new - UsageLimit and UsageData Codable models)
  - ClaudeUsageTests/ClaudeUsageTests.swift (updated - added 4 JSON decoding tests)
  - ClaudeUsage.xcodeproj/project.pbxproj (updated - added UsageData.swift to project)
  - prd.json (updated - US-002 passes: true)
- **Learnings for future iterations:**
  - API date format includes fractional seconds — need custom ISO8601 decoder with .withFractionalSeconds option
  - XCTAssertEqual with accuracy: parameter requires non-optional Double — use force unwrap (!) for optional values in test assertions where the value is known to exist
  - resets_at can be null even when the limit object itself is non-null (e.g. seven_day_sonnet with utilization 0.0)
  - New .swift files need 4 pbxproj entries: PBXFileReference, PBXBuildFile, group children, and Sources build phase files
---

## 2026-02-08 20:12 - US-003
- What was implemented: KeychainService struct with static methods for saving, reading, and deleting session key and org ID from macOS Keychain. Uses Security framework (SecItemAdd, SecItemCopyMatching, SecItemDelete) with service name "com.claudeusage.credentials".
- Files changed:
  - ClaudeUsage/Services/KeychainService.swift (new - Keychain CRUD operations)
  - ClaudeUsage.xcodeproj/project.pbxproj (updated - added KeychainService.swift to project)
  - prd.json (updated - US-003 passes: true)
- **Learnings for future iterations:**
  - Keychain operations are hard to unit test in CI (require entitlements and user keychain access), so build-only verification is sufficient
  - Always delete before adding in Keychain to handle updates — SecItemAdd fails with errSecDuplicateItem if key already exists
  - @discardableResult on delete() is useful since callers often don't care about the delete result (e.g., when called as cleanup before save)
  - Security framework is available by default on macOS — no additional framework linking needed in pbxproj
---
